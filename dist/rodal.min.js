"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),_get=function(t,e,n){for(var o=!0;o;){var i=t,a=e,r=n;s=u=l=void 0,o=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,a);if(void 0!==s){if("value"in s)return s.value;var l=s.get;return void 0===l?void 0:l.call(r)}var u=Object.getPrototypeOf(i);if(null===u)return void 0;t=u,e=a,n=r,o=!0}},_react=require("react"),_react2=_interopRequireDefault(_react),propTypes={visible:_react.PropTypes.bool,onClose:_react.PropTypes.func.isRequired,animation:_react.PropTypes.string,duration:_react.PropTypes.number,showMask:_react.PropTypes.bool,showCloseButton:_react.PropTypes.bool},defaultProps={visible:!1,animation:"zoom",duration:300,showMask:!0,showCloseButton:!0},EVENT_NAME_MAP={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},endEvents=[];!function(){var t=document.createElement("div"),e=t.style;"AnimationEvent"in window||delete EVENT_NAME_MAP.animationend.animation,"TransitionEvent"in window||delete EVENT_NAME_MAP.transitionend.transition;for(var n in EVENT_NAME_MAP){var o=EVENT_NAME_MAP[n];for(var i in o)if(i in e){endEvents.push(o[i]);break}}}();var TransitionEvents={addEndEventListener:function(t,e){return 0===endEvents.length?void window.setTimeout(e,0):void endEvents.forEach(function(n){t.addEventListener(n,e,!1)})},removeEndEventListener:function(t,e){0!==endEvents.length&&endEvents.forEach(function(n){t.removeEventListener(n,e,!1)})}},RodalBox=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t={animationDuration:this.props.duration+"ms",WebkitAnimationDuration:this.props.duration+"ms"},e="rodal-box rodal-"+this.props.animation+"-"+this.props.animationState,n=this.props.showCloseButton?_react2["default"].createElement("span",{className:"rodal-close",onClick:this.props.onClose}):null;return _react2["default"].createElement("div",{style:t,className:e},n,this.props.children)}}]),e}(_react.Component),Rodal=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={isShow:this.props.visible,animationState:this.props.visible?"enter":"leave"}}return _inherits(e,t),_createClass(e,[{key:"componentDidMount",value:function(){TransitionEvents.addEndEventListener(_react2["default"].findDOMNode(this),this.transitionEnd.bind(this))}},{key:"componentWillUnmount",value:function(){TransitionEvents.removeEndEventListener(_react2["default"].findDOMNode(this),this.transitionEnd)}},{key:"componentWillReceiveProps",value:function(t){!this.props.visible&&t.visible?this.fadeIn():this.props.visible&&!t.visible&&this.fadeOut()}},{key:"fadeIn",value:function(){this.setState({isShow:!0,animationState:"enter"})}},{key:"fadeOut",value:function(){this.setState({animationState:"leave"}),0===endEvents.length&&this.setState({isShow:!1})}},{key:"transitionEnd",value:function(t){var e=_react2["default"].findDOMNode(this);t&&t.target!==e||("enter"===this.state.animationState?this.refs.rodal.getDOMNode().focus():this.setState({isShow:!1}))}},{key:"handleKeyDown",value:function(){27===event.keyCode&&this.props.onClose()}},{key:"render",value:function(){var t={display:this.state.isShow?"block":"none",animationDuration:this.props.duration+"ms",WebkitAnimationDuration:this.props.duration+"ms"},e=this.props.showMask?_react2["default"].createElement("div",{className:"rodal-mask",onClick:this.props.onClose}):null;return _react2["default"].createElement("div",{ref:"rodal",style:t,className:"rodal rodal-fade-"+this.state.animationState,onKeyDown:this.handleKeyDown.bind(this),tabIndex:-1},e,_react2["default"].createElement(RodalBox,_extends({},this.props,{animationState:this.state.animationState}),this.props.children))}}]),e}(_react.Component);Rodal.propTypes=propTypes,Rodal.defaultProps=defaultProps,exports["default"]=Rodal,module.exports=exports["default"];