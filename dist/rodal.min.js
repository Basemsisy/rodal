"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_get=function(e,t,n){for(var o=!0;o;){var i=e,r=t,a=n;s=u=l=void 0,o=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;return void 0===l?void 0:l.call(a)}var u=Object.getPrototypeOf(i);if(null===u)return void 0;e=u,t=r,n=a,o=!0}},_react=require("react"),_react2=_interopRequireDefault(_react),propTypes={visible:_react.PropTypes.bool,onClose:_react.PropTypes.func.isRequired,animation:_react.PropTypes.string,duration:_react.PropTypes.number,showMask:_react.PropTypes.bool,showCloseButton:_react.PropTypes.bool,autoClose:_react.PropTypes.number},defaultProps={visible:!1,animation:"zoom",duration:300,showMask:!0,showCloseButton:!0},EVENT_NAME_MAP={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},endEvents=[];!function(){var e=document.createElement("div"),t=e.style;"AnimationEvent"in window||delete EVENT_NAME_MAP.animationend.animation,"TransitionEvent"in window||delete EVENT_NAME_MAP.transitionend.transition;for(var n in EVENT_NAME_MAP){var o=EVENT_NAME_MAP[n];for(var i in o)if(i in t){endEvents.push(o[i]);break}}}();var TransitionEvents={addEndEventListener:function(e,t){return 0===endEvents.length?void window.setTimeout(t,0):void endEvents.forEach(function(n){e.addEventListener(n,t,!1)})},removeEndEventListener:function(e,t){0!==endEvents.length&&endEvents.forEach(function(n){e.removeEventListener(n,t,!1)})}},RodalBox=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e={animationDuration:this.props.duration+"ms",WebkitAnimationDuration:this.props.duration+"ms"},t="rodal-box rodal-"+this.props.animation+"-"+this.props.animationType,n=this.props.showCloseButton?_react2["default"].createElement("span",{className:"rodal-close",onClick:this.props.onClose}):null;return _react2["default"].createElement("div",{style:e,className:t},n,this.props.children)}}]),t}(_react.Component),Rodal=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={isShow:this.props.visible,animationType:this.props.visible?"enter":"leave"}}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){TransitionEvents.addEndEventListener(_react2["default"].findDOMNode(this),this.transitionEnd.bind(this))}},{key:"componentWillUnmount",value:function(){TransitionEvents.removeEndEventListener(_react2["default"].findDOMNode(this),this.transitionEnd)}},{key:"componentWillReceiveProps",value:function(e){!this.props.visible&&e.visible?this.fadeIn():this.props.visible&&!e.visible&&this.fadeOut()}},{key:"fadeIn",value:function(){this.setState({isShow:!0,animationType:"enter"})}},{key:"fadeOut",value:function(){this.setState({animationType:"leave"}),0===endEvents.length&&this.setState({isShow:!1})}},{key:"transitionEnd",value:function(e){var t=_react2["default"].findDOMNode(this);e&&e.target!==t||("enter"===this.state.animationType?this.refs.rodal.getDOMNode().focus():this.setState({isShow:!1}))}},{key:"handleKeyDown",value:function(){27===event.keyCode&&this.props.onClose()}},{key:"render",value:function(){var e={display:this.state.isShow?"block":"none",animationDuration:this.props.duration+"ms",WebkitAnimationDuration:this.props.duration+"ms"},t=this.props.showMask?_react2["default"].createElement("div",{className:"rodal-mask",onClick:this.props.onClose}):null,n=this.state.animationType,o=this.props.autoClose;return"number"==typeof o&&"enter"===n?this.autoClose=setTimeout(function(){this.props.onClose()}.bind(this),o):this.autoClose&&clearTimeout(this.autoClose),_react2["default"].createElement("div",{ref:"rodal",style:e,className:"rodal rodal-fade-"+n,onKeyDown:this.handleKeyDown.bind(this),tabIndex:-1},t,_react2["default"].createElement(RodalBox,_extends({},this.props,{animationType:n}),this.props.children))}}]),t}(_react.Component);Rodal.propTypes=propTypes,Rodal.defaultProps=defaultProps,exports["default"]=Rodal,module.exports=exports["default"];